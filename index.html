<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JUNIOR ASSOCIATE | Master Edition</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Playfair+Display:ital,wght@0,600;0,700;1,400&family=Merriweather:ital,wght@0,300;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #121212;
            --panel-bg: #1e1e1e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent-green: #00e676;
            --accent-red: #ff5252;
            --accent-blue: #2979ff;
            --accent-gold: #ffd700;
            --paper-bg: #f4f1ea;
            --paper-text: #2c2c2c;
            --border-color: #333;
            --font-serif: 'Playfair Display', serif;
            --font-body: 'Merriweather', serif;
            --font-mono: 'Fira Code', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: var(--font-mono);
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        #app-container {
            width: 100%;
            max-width: 900px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            background-color: var(--panel-bg);
            position: relative;
        }

        /* --- HEADER --- */
        header {
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
            background: #181818;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            flex-shrink: 0;
            z-index: 10;
        }

        .case-id { font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        
        .game-header-elements { display: none; align-items: center; gap: 15px; width: 100%; justify-content: space-between; }
        .trust-container { width: 150px; text-align: right; }
        .trust-label { font-size: 0.6rem; display: block; margin-bottom: 3px; color: var(--text-secondary); }
        .progress-bg { width: 100%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; width: 50%; background: var(--accent-blue); transition: width 0.5s ease, background 0.5s ease; }
        
        .btn-exit {
            background: transparent; border: none; color: var(--text-secondary); font-size: 1.2rem; cursor: pointer; padding: 5px;
        }
        .btn-exit:hover { color: var(--accent-red); }

        /* Timer Bar */
        #timer-container {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: transparent; z-index: 15;
            display: none; 
        }
        #timer-bar { height: 100%; background: var(--accent-green); width: 100%; transition: width 1s linear, background-color 0.5s; }

        /* --- MENU SCREEN --- */
        #menu-screen {
            flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px;
        }

        .menu-header { text-align: center; margin-bottom: 10px; padding-top: 10px; }
        .menu-title { font-family: var(--font-serif); font-size: 1.8rem; color: #fff; margin-bottom: 5px; }
        .menu-subtitle { font-size: 0.8rem; color: var(--text-secondary); }

        /* Global Progress */
        .global-progress-container { margin-bottom: 20px; padding: 0 10px; }
        .global-label { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--accent-gold); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .global-bar-bg { width: 100%; height: 8px; background: #333; border-radius: 4px; overflow: hidden; }
        .global-bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent-blue), var(--accent-gold)); width: 0%; transition: width 0.5s ease; }

        /* Case Grid */
        .case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .case-tile {
            background: #252525;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .case-tile:hover { transform: translateY(-2px); border-color: var(--accent-blue); }
        .case-tile.completed { border-color: var(--accent-green); background: rgba(0, 230, 118, 0.05); }
        .case-tile.complex { border-top: 3px solid var(--accent-gold); }

        .tile-id { font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 5px; }
        .tile-title { font-size: 0.9rem; font-weight: 600; color: #fff; line-height: 1.3; }
        .tile-status { font-size: 1.2rem; align-self: flex-end; margin-top: 10px; }

        .exam-card {
            background: #151515; border: 2px solid #333; border-radius: 8px; padding: 20px;
            text-align: center; margin-top: 20px; cursor: default;
        }
        .exam-card.unlocked { border-color: var(--accent-gold); cursor: pointer; animation: pulse 2s infinite; }
        @keyframes pulse { 0% {box-shadow: 0 0 0 rgba(255, 215, 0, 0);} 50% {box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);} 100% {box-shadow: 0 0 0 rgba(255, 215, 0, 0);} }

        /* --- GAME SCREEN --- */
        #game-screen { display: none; flex: 1; flex-direction: column; overflow: hidden; position: relative; }

        #chat-window {
            flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth;
        }

        /* CASE FILE */
        .case-file-doc {
            background: var(--paper-bg); color: var(--paper-text); font-family: var(--font-body);
            padding: 25px; border-left: 6px solid #8b0000; box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            border-radius: 2px; margin-bottom: 20px; position: relative;
            animation: slideIn 0.5s ease;
        }
        .case-file-doc::before { content: "SACHVERHALT"; position: absolute; top: 10px; right: 10px; font-family: var(--font-mono); font-size: 0.6rem; border: 1px solid #8b0000; color: #8b0000; padding: 2px 5px; transform: rotate(-5deg); opacity: 0.7; }
        .case-file-text { font-size: 0.95rem; line-height: 1.6; }

        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .message {
            max-width: 85%; padding: 15px 20px; border-radius: 4px; animation: fadeIn 0.3s ease-up; line-height: 1.5; position: relative;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .message.partner {
            align-self: flex-start; background-color: #252525; border-left: 3px solid var(--text-secondary);
            font-family: var(--font-serif); font-size: 1.1rem; color: #fff;
        }
        .message.partner::before { content: "SENIOR PARTNER"; position: absolute; top: -18px; left: 0; font-family: var(--font-mono); font-size: 0.6rem; color: var(--text-secondary); }

        .message.user { align-self: flex-end; background-color: #2a3b4d; border-right: 3px solid var(--accent-blue); text-align: right; font-size: 0.95rem; }

        .message.system { align-self: center; font-size: 0.8rem; padding: 8px 15px; border-radius: 20px; text-transform: uppercase; letter-spacing: 1px; text-align: center; }
        .message.system.success { color: var(--accent-green); border: 1px solid var(--accent-green); background: rgba(0, 230, 118, 0.05); }
        .message.system.fail { color: var(--accent-red); border: 1px solid var(--accent-red); background: rgba(255, 82, 82, 0.05); }
        .message.system.warn { color: var(--accent-gold); border: 1px solid var(--accent-gold); background: rgba(255, 215, 0, 0.05); }

        /* --- INPUT AREA --- */
        #input-area {
            padding: 20px; border-top: 1px solid var(--border-color); background: #181818; min-height: 140px; display: flex; flex-direction: column; justify-content: center; gap: 10px;
        }
        
        .text-input-wrapper { display: flex; gap: 10px; flex-direction: column; }
        textarea { 
            flex: 1; background: transparent; border: 1px solid var(--text-secondary); color: #fff; padding: 12px; font-family: var(--font-mono); outline: none; resize: none; min-height: 100px; font-size: 0.9rem;
        }
        textarea:focus { border-color: var(--accent-blue); }
        .btn-submit { background: var(--accent-blue); color: #fff; border: none; padding: 12px; cursor: pointer; font-family: var(--font-mono); font-weight: 600; text-transform: uppercase; }
        
        .btn-giveup {
            width: 100%; padding: 10px; background: transparent; border: 1px dashed var(--text-secondary); color: var(--text-secondary);
            font-family: var(--font-mono); cursor: pointer; font-size: 0.8rem; text-transform: uppercase;
        }
        .btn-giveup:hover { border-color: var(--accent-red); color: var(--accent-red); }

        /* Comparison View */
        #comparison-view { display: none; flex-direction: column; gap: 15px; width: 100%; }
        .compare-box { background: #222; border: 1px solid #444; padding: 10px; border-radius: 6px; }
        .compare-label { font-size: 0.7rem; text-transform: uppercase; color: #888; margin-bottom: 5px; }
        .user-text { color: #fff; font-family: var(--font-mono); font-size: 0.9rem; white-space: pre-wrap; }
        .model-text { color: var(--accent-green); font-family: var(--font-serif); font-size: 1rem; line-height: 1.6; white-space: pre-wrap; }
        
        .assessment-buttons { display: flex; gap: 10px; margin-top: 10px; }
        .btn-assess-ok { flex: 1; background: rgba(0, 230, 118, 0.1); border: 1px solid var(--accent-green); color: var(--accent-green); padding: 15px; cursor: pointer; font-family: var(--font-mono); }
        .btn-assess-no { flex: 1; background: rgba(255, 82, 82, 0.1); border: 1px solid var(--accent-red); color: var(--accent-red); padding: 15px; cursor: pointer; font-family: var(--font-mono); }
        .btn-assess-ok:hover { background: var(--accent-green); color: #000; }
        .btn-assess-no:hover { background: var(--accent-red); color: #000; }

        /* --- ARCHIVE & OVERLAYS --- */
        #archive-screen {
            display: none; flex: 1; padding: 20px; overflow-y: auto; flex-direction: column; background: var(--bg-color);
        }
        .archive-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;}
        .archive-list { display: flex; flex-direction: column; gap: 30px; }
        .archive-item { background: #1a1a1a; padding: 20px; border-radius: 6px; border-left: 3px solid var(--text-secondary); margin-bottom: 15px; }
        .archive-q { font-weight: bold; margin-bottom: 10px; color: #fff; font-family: var(--font-serif); font-size: 1.1rem; }
        .archive-sol { font-size: 0.95rem; color: var(--text-primary); white-space: pre-wrap; line-height: 1.6; }
        .exam-grade-input { width: 60px; background: #000; border: 1px solid #555; color: #fff; text-align: center; padding: 5px; margin-left: 10px; }

        #game-over-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(18, 18, 18, 0.98);
            display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }
        .status-text { font-family: var(--font-serif); font-size: 2.5rem; margin-bottom: 10px; text-transform: uppercase; text-align: center; }
        .status-sub { font-size: 1rem; color: #888; margin-bottom: 30px; text-align: center; padding: 0 20px;}
        .btn-back { background: transparent; border: 1px solid #fff; color: #fff; padding: 12px 30px; cursor: pointer; font-family: var(--font-mono); margin-top: 10px; text-transform: uppercase; }
        .btn-back:hover { background: #fff; color: #000; }

        .dev-btn { position: fixed; bottom: 5px; right: 5px; opacity: 0.1; font-size: 0.7rem; cursor: pointer; color: #fff; z-index: 200; border: 1px solid #fff; padding: 2px;}
        .dev-btn:hover { opacity: 1; }
        .reset-trigger { position: fixed; bottom: 5px; left: 5px; opacity: 0.2; font-size: 1.5rem; cursor: pointer; z-index: 200; }
    </style>
</head>
<body>

    <div id="app-container">
        <header>
            <div class="case-id" id="header-title">JUNIOR ASSOCIATE v20.0</div>
            <div class="game-header-elements" id="game-header-elements">
                <div class="trust-container">
                    <span class="trust-label">PARTNER'S TRUST</span>
                    <div class="progress-bg"><div class="progress-fill" id="trust-bar"></div></div>
                </div>
                <button class="btn-exit" onclick="exitToMenu()">‚úï</button>
            </div>
            <div id="timer-container"><div id="timer-bar"></div></div>
        </header>

        <div id="menu-screen">
            <div class="menu-header">
                <div class="menu-title">Aktenbestand</div>
                <div class="menu-subtitle">20 F√§lle zur Bearbeitung</div>
            </div>
            <div class="global-progress-container">
                <div class="global-label"><span>Fortschritt (Mastered)</span><span id="global-pct">0%</span></div>
                <div class="global-bar-bg"><div class="global-bar-fill" id="global-bar"></div></div>
            </div>
            <div id="case-list" class="case-grid"></div>
            <div id="exam-card" class="exam-card">
                <div style="font-size: 2rem;">üîí</div>
                <div class="case-title" style="margin-top: 10px; color: #666;">ABSCHLUSSKLAUSUR</div>
                <div class="case-subtitle" style="color: #444;">Freigabe bei 100% Gesamtzulassung</div>
            </div>
        </div>

        <div id="archive-screen">
            <div class="archive-header">
                <div class="menu-title" style="font-size: 1.2rem;" id="archive-title">Korrekturnotizen</div>
                <button class="btn-back" style="margin:0; padding: 5px 15px; font-size: 0.8rem;" onclick="exitToMenu()">Zur√ºck</button>
            </div>
            <div id="archive-content" class="archive-list"></div>
            <div id="exam-result-footer" style="display:none; padding: 20px; text-align: center; border-top: 1px solid #333; margin-top: 20px;">
                <button class="btn-assess-ok" onclick="calculateGrade()">NOTENBERECHNUNG ABSCHLIE√üEN</button>
            </div>
        </div>

        <div id="game-screen">
            <div id="chat-window"></div>
            <div id="input-area"></div>
        </div>

        <div id="game-over-screen">
            <div class="status-text" id="overlay-title">STATUS</div>
            <div class="status-sub" id="overlay-msg"></div>
            <button class="btn-back" onclick="exitToMenu()">Zur√ºck zur √úbersicht</button>
        </div>
        
        <div class="reset-trigger" onclick="hardReset()" title="Reset">üóëÔ∏è</div>
        <div class="dev-btn" onclick="devUnlock()">[DEV: Unlock]</div>
    </div>

    <script>
        // --- COMPLETE DATABASE (VERBATIM) ---
        const cases = [
            { id: 1, title: "Akte 01", subtitle: "Systematische Auslegung", type: "short", points: 1, question: "Ein Gesetz ist unklar. Wir ermitteln den Inhalt anhand der Stellung im Gesetz. Welche Auslegung?", keywords: ["Systematisch", "Stellung", "Kontext"], detailed_solution: `Systematische Auslegung ist das Feststellen des normativen Aussagegehaltes einer Norm anhand ihrer Stellung im Gesetz oder im Gesamtzusammenhang der Rechtsordnung.` },
            { id: 2, title: "Akte 02", subtitle: "Historische Auslegung", type: "short", points: 1, question: "Was versteht man unter 'Historischer Auslegung'? Worauf stellen wir ab?", keywords: ["Wille", "Gesetzgeber", "Geschichte"], detailed_solution: `Historische Auslegung ist die Ermittlung des Norminhalts durch Erforschung des Willens des historischen Gesetzgebers anhand der Entstehungsgeschichte (Gesetzesmaterialien, Protokolle).` },
            { id: 3, title: "Akte 03", subtitle: "Verfassungskonforme Auslegung", type: "short", points: 1, question: "Ein Gesetz verst√∂√üt scheinbar gegen das GG. Was besagt die 'verfassungskonforme Auslegung'?", keywords: ["Normerhalt", "G√ºltig", "Vereinbar"], detailed_solution: `Verfassungskonforme Auslegung bedeutet, dass wenn ein Gesetz mehrere Deutungen zul√§sst, diejenige zu w√§hlen ist, die mit dem Grundgesetz vereinbar ist. Die Norm bleibt g√ºltig.` },
            { id: 4, title: "Akte 04", subtitle: "Anstalt vs. K√∂rperschaft", type: "short", points: 1, question: "Definieren Sie 'Anstalt des √∂ffentlichen Rechts' und grenzen Sie zur K√∂rperschaft ab.", keywords: ["Benutzer", "Mitglieder", "Personal", "Sachmittel"], detailed_solution: `Anstalt ist eine Zusammenfassung von Personal- und Sachmitteln zur Erf√ºllung einer √∂ffentlichen Aufgabe, die Benutzern zur Verf√ºgung steht. Eine K√∂rperschaft ist mitgliedschaftlich organisiert (besteht aus Mitgliedern).` },
            { id: 5, title: "Akte 05", subtitle: "Gesetzesverk√ºndung", type: "short", points: 1, question: "Wo werden vom Bundespr√§sidenten ausgefertigte Gesetze ver√∂ffentlicht?", keywords: ["Bundesgesetzblatt"], detailed_solution: `Gesetze werden im Bundesgesetzblatt ver√∂ffentlicht.` },
            
            // --- COMPLEX CASE 6 ---
            { 
                id: 6, title: "Akte 06", subtitle: "Fall: Nossen vs. Ketzerbachtal", type: "complex", points: 5, 
                context: "Die s√§chsische Stadt Nossen und die Gemeinde Ketzerbachtal bilden eine Verwaltungsgemeinschaft nach dem S√§chsKomZG. Ketzerbachtal will Nossen auf Schadensersatz verklagen, weil Aufgaben nicht richtig wahrgenommen wurden.",
                question: "Pr√ºfen und erl√§utern Sie, ob der Rechtsweg zu den Verwaltungsgerichten er√∂ffnet ist. Gehen Sie auf die Abgrenzungstheorien ein.",
                keywords: ["Subordination", "Interesse", "Subjekt", "Sonderrecht", "S√§chsKomZG", "√∂ffentlich"],
                detailed_solution: `Rechtsweg: Gem√§√ü ¬ß 40 VwGO ist der Verwaltungsrechtsweg er√∂ffnet (1Punkt), wenn eine √∂ffentlich-rechtliche Streitigkeit nichtverfassungsrechtlicher Art vorliegt. (1Punkt)

Abgrenzungstheorien (je 1 Punkt):
Zu beachten ist, dass diese Theorien oftmals bei bestimmten Problemf√§llen versagen, weshalb man sie kumulativ anwendet. (1Punkt)

1. Subordinationstheorie: Liegt ein √úber-/Unterordnungsverh√§ltnis vor?
Ist im Fall nicht festzustellen, keine √úber/Unterordnung sondern eher Gleichordnung.

2. Subjektstheorie: Handelt ein staatlicher Hoheitstr√§ger?
S√§mtliche Mitgliedsgemeinden sind K√∂rperschaften des √∂ffentlichen Rechts
=> auf beiden Seiten √∂ffentlich rechtliche Rechtstr√§ger -> off.rechtliche Streitigkeit.

3. Interessentheorie: Dient die Norm dem √∂ffentlichen Interesse oder dem Individualinteresse?
Streitigkeit durch S√§chsKomZG bearbeitet => es geht um kommunale Zusammenarbeit => es geht origin√§r um √∂ffentliche Interessen und der mittelbaren Staatsverwaltung.

4. Modifizierte Subjektstheorie (Sonderrechtstheorie): Berechtigt oder verpflichtet die Norm einen Hoheitstr√§ger gerade in seiner Eigenschaft als solcher?
Aus Gemeinden gebildete Verwaltungsgemeinschaft + St√§dte/Gemeinden selbst sind Zuordnungssubjekt des S√§chsKomZG aus dem Rechte und Pflichten folgen.

Subsumtion (Anwendung): Da es um kommunale Zusammenarbeit geht (origin√§re √∂ffentliche Interessen) und das Gesetz (S√§chsKomZG) die Gemeinden/Verwaltungsgemeinschaft als Hoheitstr√§ger berechtigt/verpflichtet (Zuordnungssubjekt), ist es √∂ffentliches Recht.`
            },

            // --- COMPLEX CASE 7 ---
            {
                id: 7, title: "Akte 07", subtitle: "Fall: Windkraft", type: "complex", points: 6,
                context: "August F√∂rster (Hotelier) f√ºrchtet L√§rm und Aussichtsverlust durch genehmigte Windkraftanlagen in 1000m Entfernung. Er will klagen.",
                question: "Kann er die Genehmigung angreifen? (Statthaftigkeit, Klagebefugnis, Frist)",
                keywords: ["Anfechtungsklage", "Widerspruch", "Klagebefugnis", "M√∂glichkeit", "14", "70"],
                detailed_solution: `Verwaltungsakt: Die Genehmigung ist ein Verwaltungsakt i.S.v. ¬ß 35 VwVfG.
Statthafte Klageart: Anfechtungsklage (¬ß 42 Abs. 1 Alt. 1 VwGO), da die Aufhebung eines VA begehrt wird (1Punkt). Der nach ¬ß68 VwGO vorgeschaltete Rechtsbehelf ist ein Widerspruch.
Klagebefugnis nach (¬ß 42 Abs. 2 VwGO) setzt voraus: Dass der Kl√§ger zumindest die M√∂glichkeit einer Verletzung in eigenen subjektiven Rechten geltend machen (M√∂glichkeitstheorie) kann.
Subsumtion: Die Klagebefugnis liegt vor, da eine Rechtsverletzung trotz 1000 m Entfernung zumindest m√∂glich ist (M√∂glichkeitstheorie). Betroffen ist prim√§r das Eigentum am eingerichteten und ausge√ºbten Gewerbebetrieb (Art. 14 GG); eine Verletzung der Berufsfreiheit (Art. 12 GG) ist fraglich (wegen fehlender berufsregelnder Tendenz), aber vertretbar.
Frist: 1 Monat (¬ß 70 VwGO).`
            },

            { id: 8, title: "Akte 08", subtitle: "Normarten (TKG)", type: "short", points: 3, question: "Bestimmen Sie die Normarten: 1. ¬ß 87 I TKG (Ziel), 2. ¬ß 110 I TKG (Wenn-Dann), 3. ¬ß 3 TKG (Begriff).", keywords: ["Final", "Konditional", "Deskriptiv"], detailed_solution: `a) ¬ß 87 TKG: Final gefasste Norm (Zielvorgabe). b) ¬ß 110 TKG: Konditional gefasste Norm (Wenn-Dann). c) ¬ß 3 TKG: Deskriptiv gefasste Norm (Begriffsbestimmung).` },
            { id: 9, title: "Akte 09", subtitle: "Art. 13 GG (Wohnung)", type: "short", points: 2, question: "Art. 13 GG (Wohnung). Gelten Gesch√§ftsr√§ume als Wohnung? Und wann sind sie gesch√ºtzt?", keywords: ["Ja", "√ñffnungszeiten", "Schutz"], detailed_solution: `Ja, Gesch√§ftsr√§ume fallen unter den Wohnungsbegriff. Aber: W√§hrend der √ñffnungszeiten ist der Schutz stark eingeschr√§nkt (Betretungsrecht), nach Ladenschluss gilt der volle Schutz.` },

            // --- COMPLEX CASE 10 ---
            {
                id: 10, title: "Akte 10", subtitle: "Fall: ZDF Staatsvertrag", type: "complex", points: 7,
                context: "Streit um ZDF-Staatsvertrag. Einflussnahme der Politik auf Postenbesetzung (Intendant vs. Verwaltungsrat).",
                question: "Kann sich das ZDF auf Rechte aus der Verfassung berufen, um Einflussnahme abzuwehren?",
                keywords: ["Konfusion", "Rundfunkfreiheit", "Vielfalt", "Staatsferne", "Drittel"],
                detailed_solution: `1. Der Grundsatz: Grunds√§tzlich sind Grundrechte Abwehrrechte des Einzelnen gegen den Staat. Der Staat (Konfusionsargument) kann sich nicht selbst auf Grundrechte berufen.

2. Die Ausnahme: Juristische Personen des √∂ffentlichen Rechts k√∂nnen sich berufen, wenn sie einem grundrechtlich gesch√ºtzten Lebensbereich zugeordnet sind und in einer grundrechtstypischen Gef√§hrdungslage stehen.

3. Anwendung Rundfunkfreiheit (Art. 5 I 2 GG): Auch √∂ffentlich-rechtliche Rundfunkanstalten k√∂nnen sich darauf berufen (Sicherung freier Berichterstattung).

4. Anforderungen an Gremien:
A) Gebot der Vielfaltsicherung: Das Gremium muss ein Spiegelbild der Gesellschaft sein (relevante gesellschaftliche Gruppen).
B) Gebot der Staatsferne: Der Einfluss des Staates muss begrenzt sein.
- Die Drittel-Quote: Anteil staatlicher Mitglieder darf 1/3 nicht √ºbersteigen.
- Einflussverbot: Exekutive darf keinen bestimmenden Einfluss auf Auswahl der staatsfernen Mitglieder haben.`
            },

            { id: 11, title: "Akte 11", subtitle: "Demokratieprinzip", type: "short", points: 2, question: "Nennen Sie ein Beispiel im GG, in dem das Demokratieprinzip zum Ausdruck kommt.", keywords: ["20", "Wahlen", "Abstimmung"], detailed_solution: `Art. 20 Abs. 1 und 2 GG: Alle Staatsgewalt geht vom Volke aus (Wahlen und Abstimmungen).` },
            { id: 12, title: "Akte 12", subtitle: "Corona-Kompetenz", type: "short", points: 1, question: "Wer hat die Kompetenz f√ºr die 'Corona-Notbremse' (Infektionsschutz)?", keywords: ["Bund", "74", "Krankheiten"], detailed_solution: `Der Bund (konkurrierende Gesetzgebung). Art. 74 I Nr. 19 GG (Ma√ünahmen gegen gemeingef√§hrliche oder √ºbertragbare Krankheiten).` },
            { id: 13, title: "Akte 13", subtitle: "EU-Grundfreiheiten", type: "short", points: 2, question: "Nennen Sie zwei EU-Grundfreiheiten.", keywords: ["Waren", "Arbeitnehmer", "Dienstleistung", "Kapital"], detailed_solution: `Warenverkehrsfreiheit, Arbeitnehmerfreiz√ºgigkeit, Dienstleistungsfreiheit, Niederlassungsfreiheit, Kapitalverkehrsfreiheit.` },
            { id: 14, title: "Akte 14", subtitle: "Amtshaftung", type: "short", points: 2, question: "Beh√∂rde arbeitet zu langsam -> Schaden. Anspruchsgrundlage?", keywords: ["839", "34"], detailed_solution: `¬ß 839 BGB i.V.m. Art. 34 GG (Amtspflichtverletzung).` },
            { id: 15, title: "Akte 15", subtitle: "VA Definition", type: "short", points: 3, question: "Definition Verwaltungsakt (¬ß 35 VwVfG).", keywords: ["Hoheitlich", "Beh√∂rde", "Regelung", "Einzelfall", "Au√üenwirkung"], detailed_solution: `Hoheitliche Ma√ünahme einer Beh√∂rde auf dem Gebiet des √∂ffentlichen Rechts zur Regelung eines Einzelfalls mit unmittelbarer Rechtswirkung nach au√üen.` },
            { id: 16, title: "Akte 16", subtitle: "Ermessensfehler", type: "short", points: 1, question: "Nennen Sie einen typischen Ermessensfehler.", keywords: ["Nichtgebrauch", "√úberschreitung", "Fehlgebrauch"], detailed_solution: `Ermessensnichtgebrauch, Ermessens√ºberschreitung oder Ermessensfehlgebrauch.` },
            { id: 17, title: "Akte 17", subtitle: "Widerruf", type: "short", points: 2, question: "Wie nennt man die nachtr√§gliche Aufhebung eines rechtm√§√üigen VA? (¬ß 49 VwVfG)", keywords: ["Widerruf"], detailed_solution: `Widerruf (¬ß 49 VwVfG). (Abgrenzung: R√ºcknahme ¬ß 48 VwVfG gilt f√ºr rechtswidrige VAs).` },
            { id: 18, title: "Akte 18", subtitle: "EU-Richtlinien", type: "short", points: 2, question: "Wann wirken EU-Richtlinien unmittelbar f√ºr den B√ºrger?", keywords: ["Frist", "Bestimmt", "Vertikal"], detailed_solution: `Wenn die Umsetzungsfrist abgelaufen ist und die Richtlinie inhaltlich unbedingt und hinreichend bestimmt ist (vertikale unmittelbare Wirkung).` },
            { id: 19, title: "Akte 19", subtitle: "EU-Grundrechte", type: "short", points: 2, question: "Woher kommen die EU-Grundrechte? (Rechtsquellen)", keywords: ["Charta", "EMRK", "Verfassungs√ºberlieferung"], detailed_solution: `Art. 6 EUV: Charta der Grundrechte, EMRK und die gemeinsamen Verfassungs√ºberlieferungen der Mitgliedstaaten.` },

            // --- COMPLEX CASE 20 ---
            {
                id: 20, title: "Akte 20", subtitle: "Fall: Busunternehmer", type: "complex", points: 5,
                context: "Ein Busunternehmer hat erhebliche Steuerschulden und zahlt keine Sozialabgaben mehr. Das Landratsamt m√∂chte ihm die Genehmigung entziehen.",
                question: "EGL und Tatbestandsvoraussetzungen?",
                keywords: ["PBefG", "25", "Widerruf", "Unzuverl√§ssigkeit", "Prognose"],
                detailed_solution: `1. Rechtsgrundlage: Spezialgesetz Personenbef√∂rderungsgesetz (PBefG), nicht GewO. Widerruf der Genehmigung gem. ¬ß 25 Abs. 1 PBefG.

2. Tatbestandsvoraussetzungen:
- Wegfall der Genehmigungsvoraussetzungen (¬ß 13 PBefG).
- Konkrete Tatsachen (z.B. Steuerschulden).
- Unzuverl√§ssigkeit: Gewerbetreibender bietet keine Gew√§hr f√ºr ordnungsgem√§√üen Betrieb (negative Zukunftsprognose).
- Erforderlichkeit/Verh√§ltnism√§√üigkeit: Widerruf muss zum Schutz der Allgemeinheit erforderlich sein.`
            }
        ];

        // --- ENGINE ---
        let activeCase = null;
        let savedProgress = {}; // Stores "true" for passed cases
        let isExamMode = false;
        let examAnswers = [];
        let timerInterval = null;
        let timeLeft = 0;

        try {
            const data = localStorage.getItem('junior_lawyer_save_v20');
            if (data) savedProgress = JSON.parse(data);
        } catch (e) { savedProgress = {}; }

        // DOM
        const menuScreen = document.getElementById('menu-screen');
        const gameScreen = document.getElementById('game-screen');
        const archiveScreen = document.getElementById('archive-screen');
        const caseList = document.getElementById('case-list');
        const archiveContent = document.getElementById('archive-content');
        const chatWindow = document.getElementById('chat-window');
        const inputArea = document.getElementById('input-area');
        const overlay = document.getElementById('game-over-screen');
        const globalBar = document.getElementById('global-bar');
        const globalPct = document.getElementById('global-pct');
        const examCardDiv = document.getElementById('exam-card');
        const timerContainer = document.getElementById('timer-container');
        const timerBar = document.getElementById('timer-bar');

        function init() { renderMenu(); }

        // --- MENU RENDERER ---
        function renderMenu() {
            caseList.innerHTML = '';
            let completedCount = 0;
            cases.forEach(c => {
                const isDone = savedProgress[c.id] === true;
                if(isDone) completedCount++;
                const card = document.createElement('div');
                card.className = `case-tile ${c.type === 'complex' ? 'complex' : ''} ${isDone ? 'completed' : ''}`;
                card.onclick = () => openCase(c);
                card.innerHTML = `
                    <div>
                        <div class="tile-id">${c.title}</div>
                        <div class="tile-title">${c.subtitle}</div>
                    </div>
                    <div class="tile-status">${isDone ? '‚úÖ' : 'üìÇ'}</div>
                `;
                caseList.appendChild(card);
            });

            // GLOBAL PROGRESS
            const pct = Math.round((completedCount / cases.length) * 100);
            globalBar.style.width = pct + "%";
            globalPct.innerText = pct + "%";

            // EXAM UNLOCK
            if(pct >= 100) {
                examCardDiv.classList.add('unlocked');
                examCardDiv.onclick = startExam;
                examCardDiv.innerHTML = `<div style="font-size:2rem">üìú</div><div class="tile-title" style="margin-top:10px; color:var(--accent-gold)">KLAUSUR STARTEN</div>`;
            } else {
                examCardDiv.classList.remove('unlocked');
                examCardDiv.onclick = null;
                examCardDiv.innerHTML = `<div style="font-size:2rem">üîí</div><div class="tile-title" style="margin-top:10px; color:#666">ABSCHLUSSKLAUSUR</div>`;
            }
        }

        // --- TRAINING MODE ---
        function openCase(c) {
            activeCase = c;
            isExamMode = false;
            menuScreen.style.display = 'none';
            gameScreen.style.display = 'flex';
            timerContainer.style.display = 'block';
            
            chatWindow.innerHTML = '';
            inputArea.innerHTML = '';
            
            // INTRO
            addMsg('system', `AKTE GE√ñFFNET: ${c.subtitle}`, 'info');
            
            // SHOW CONTEXT IF COMPLEX
            if(c.type === 'complex') {
                const doc = document.createElement('div');
                doc.className = 'case-file-doc';
                doc.innerHTML = `<div class="case-file-text">${c.context}</div>`;
                chatWindow.appendChild(doc);
            }

            // SHOW QUESTION
            setTimeout(() => {
                addMsg('partner', c.question);
                renderInput();
                startTimer(180); // 3 mins for training
            }, 600);
        }

        function renderInput() {
            inputArea.innerHTML = '';
            const wrp = document.createElement('div');
            wrp.className = 'text-input-wrapper';
            const area = document.createElement('textarea');
            area.placeholder = "Ihre L√∂sung...";
            const btn = document.createElement('button');
            btn.className = 'btn-submit';
            btn.innerText = 'L√∂sung pr√ºfen';
            btn.onclick = () => validateAnswer(area.value);
            wrp.append(area, btn);
            inputArea.appendChild(wrp);
            area.focus();
        }

        function validateAnswer(userText) {
            stopTimer();
            // SMART CHECK
            const missing = activeCase.keywords.filter(k => !userText.toLowerCase().includes(k.toLowerCase()));
            
            if(missing.length === 0) {
                addMsg('system', '‚úÖ Alle Schl√ºsselbegriffe erkannt.', 'success');
            } else {
                addMsg('system', `‚ö†Ô∏è Es fehlen Begriffe: ${missing.join(', ')}`, 'warn');
            }

            // SHOW FULL SOLUTION FOR SELF-CORRECTION
            inputArea.innerHTML = '';
            const cmp = document.createElement('div');
            cmp.id = 'comparison-view';
            cmp.innerHTML = `
                <div class="compare-box">
                    <div class="compare-label">Ihre Eingabe</div>
                    <div class="user-text">${userText}</div>
                </div>
                <div class="compare-box" style="border-color:var(--accent-green)">
                    <div class="compare-label" style="color:var(--accent-green)">Musterl√∂sung (Originaltext)</div>
                    <div class="model-text">${activeCase.detailed_solution}</div>
                </div>
                <div class="assessment-buttons">
                    <button class="btn-assess-no" onclick="retryCase()">Wiederholen</button>
                    <button class="btn-assess-ok" onclick="passCase()">Korrekt</button>
                </div>
            `;
            inputArea.appendChild(cmp);
            document.getElementById('comparison-view').style.display = 'flex';
        }

        function passCase() {
            addMsg('system', 'FALL BEHERRSCHT', 'success');
            savedProgress[activeCase.id] = true;
            localStorage.setItem('junior_lawyer_save_v20', JSON.stringify(savedProgress));
            setTimeout(exitToMenu, 1000);
        }

        function retryCase() {
            addMsg('system', 'WIRD WIEDERHOLT', 'fail');
            setTimeout(exitToMenu, 1000);
        }

        // --- EXAM MODE ---
        let examIndex = 0;
        function startExam() {
            isExamMode = true;
            examIndex = 0;
            examAnswers = [];
            menuScreen.style.display = 'none';
            gameScreen.style.display = 'flex';
            timerContainer.style.display = 'none';
            chatWindow.innerHTML = '';
            addMsg('system', 'PR√úFUNG GESTARTET', 'info');
            nextExamQ();
        }

        function nextExamQ() {
            if(examIndex >= cases.length) { finishExam(); return; }
            const c = cases[examIndex];
            
            // RENDER EXAM QUESTION
            chatWindow.innerHTML = ''; // Clear for focus
            addMsg('system', `AUFGABE ${examIndex+1} / ${cases.length}`, 'info');
            
            if(c.type === 'complex') {
                const doc = document.createElement('div');
                doc.className = 'case-file-doc';
                doc.innerHTML = `<div class="case-file-text">${c.context}</div>`;
                chatWindow.appendChild(doc);
            }
            addMsg('partner', c.question);

            inputArea.innerHTML = '';
            const wrp = document.createElement('div');
            wrp.className = 'text-input-wrapper';
            const area = document.createElement('textarea');
            area.placeholder = "Pr√ºfungsantwort...";
            const btn = document.createElement('button');
            btn.className = 'btn-submit';
            btn.innerText = 'Einreichen & Weiter';
            btn.onclick = () => {
                examAnswers.push({ case: c, ans: area.value });
                examIndex++;
                nextExamQ();
            };
            wrp.append(area, btn);
            inputArea.appendChild(wrp);
            area.focus();
        }

        function finishExam() {
            gameScreen.style.display = 'none';
            archiveScreen.style.display = 'flex';
            archiveContent.innerHTML = '';
            document.getElementById('archive-title').innerText = "Korrekturphase";
            document.getElementById('exam-result-footer').style.display = 'block';
            
            let totalPoints = 0;
            examAnswers.forEach((item, i) => {
                const c = item.case;
                totalPoints += c.points;
                const div = document.createElement('div');
                div.className = 'archive-item';
                div.innerHTML = `
                    <div class="archive-q">Aufgabe ${i+1}: ${c.subtitle} (${c.points} Pkt)</div>
                    <div style="display:flex; gap:15px; flex-wrap:wrap">
                        <div style="flex:1"><div style="font-size:0.7rem; color:#888">IHRE ANTWORT</div><div class="user-text" style="border:1px solid #444; padding:10px;">${item.ans}</div></div>
                        <div style="flex:1"><div style="font-size:0.7rem; color:var(--accent-green)">L√ñSUNG</div><div class="model-text">${c.detailed_solution}</div></div>
                    </div>
                    <div style="text-align:right; margin-top:10px;">
                        Punkte: <input type="number" class="exam-grade-input" id="grade-${i}" min="0" max="${c.points}" value="0"> / ${c.points}
                    </div>
                `;
                archiveContent.appendChild(div);
            });
        }

        function calculateGrade() {
            let userScore = 0;
            let maxScore = 0;
            examAnswers.forEach((item, i) => {
                userScore += parseInt(document.getElementById(`grade-${i}`).value) || 0;
                maxScore += item.case.points;
            });
            let pct = (userScore/maxScore)*100;
            let note = pct < 50 ? "Mangelhaft" : (pct < 65 ? "Ausreichend" : (pct < 80 ? "Befriedigend" : "Pr√§dikat"));
            let color = pct < 50 ? "var(--accent-red)" : "var(--accent-green)";
            
            archiveContent.innerHTML = `<div style="text-align:center; padding:50px;">
                <h1 style="color:${color}; font-size:3rem">${note}</h1>
                <p>Punkte: ${userScore} / ${maxScore} (${Math.round(pct)}%)</p>
                <button class="btn-assess-ok" style="margin-top:20px;" onclick="exitToMenu()">Beenden</button>
            </div>`;
            document.getElementById('exam-result-footer').style.display = 'none';
        }

        // --- UTILS ---
        function startTimer(sec) {
            timeLeft = sec;
            timerBar.style.width = '100%';
            timerBar.style.backgroundColor = 'var(--accent-green)';
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                let p = (timeLeft/sec)*100;
                timerBar.style.width = p + "%";
                if(timeLeft < 10) timerBar.style.backgroundColor = 'var(--accent-red)';
                if(timeLeft <= 0) stopTimer();
            }, 1000);
        }
        function stopTimer() { clearInterval(timerInterval); }

        function showArchive() {
            menuScreen.style.display = 'none';
            archiveScreen.style.display = 'flex';
            document.getElementById('archive-title').innerText = "Volltext-Archiv";
            archiveContent.innerHTML = '';
            document.getElementById('exam-result-footer').style.display = 'none';
            cases.forEach(c => {
                const div = document.createElement('div');
                div.className = 'archive-item';
                div.innerHTML = `<div class="archive-q">${c.title}: ${c.subtitle}</div><div class="model-text">${c.detailed_solution}</div>`;
                archiveContent.appendChild(div);
            });
        }

        function addMsg(cls, txt, type) {
            const d = document.createElement('div');
            d.className = `message ${cls} ${type||''}`;
            d.innerText = txt;
            chatWindow.appendChild(d);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function exitToMenu() {
            stopTimer();
            menuScreen.style.display = 'flex';
            gameScreen.style.display = 'none';
            archiveScreen.style.display = 'none';
            renderMenu();
        }

        function hardReset() { if(confirm("Reset?")) { localStorage.removeItem('junior_lawyer_save_v20'); location.reload(); } }
        function devUnlock() { cases.forEach(c => savedProgress[c.id]=true); localStorage.setItem('junior_lawyer_save_v20', JSON.stringify(savedProgress)); location.reload(); }

        window.onload = init;
    </script>
</body>
</html>
