<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jura Flow</title>
    <style>
        :root {
            --bg: #F5F5F7;
            --text: #1D1D1F;
            --bubble-bg: #FFFFFF;
            --bubble-shadow: 0 4px 12px rgba(0,0,0,0.08);
            --accent: #007AFF;
            --success: #34C759;
            --error: #FF3B30;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* Header */
        .header {
            padding: 20px;
            text-align: center;
            padding-top: 50px; /* Safe area */
        }

        .category {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #86868B;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .question {
            font-size: 20px;
            font-weight: 700;
            line-height: 1.4;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Game Area */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
        }

        /* Solution Area (Top) */
        .solution-area {
            background: #E5E5EA;
            border-radius: 16px;
            min-height: 120px;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-content: flex-start;
            transition: background 0.3s;
        }
        .solution-area.complete {
            background: #D1FAE5; /* Light Green */
        }

        /* Word Pool (Bottom) */
        .pool-area {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-content: center;
            padding-bottom: 30px;
        }

        /* Bubbles */
        .bubble {
            background: var(--bubble-bg);
            padding: 12px 20px;
            border-radius: 24px;
            font-size: 16px;
            font-weight: 500;
            box-shadow: var(--bubble-shadow);
            cursor: pointer;
            transition: transform 0.2s, background 0.2s, opacity 0.2s;
            user-select: none;
            border: 1px solid transparent;
        }

        .bubble:active {
            transform: scale(0.95);
        }

        /* Animations */
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; background: #FFEEEE; border-color: var(--error); }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .pop-in { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Next Button */
        .next-btn {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--accent);
            color: white;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: 700;
            border: none;
            box-shadow: 0 10px 30px rgba(0,122,255,0.4);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0;
            pointer-events: none;
        }
        .next-btn.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
            pointer-events: all;
        }

        .progress-bar {
            position: fixed;
            top: 0; left: 0; height: 6px; background: var(--success); width: 0%; transition: width 0.5s;
        }

    </style>
</head>
<body>

    <div class="progress-bar" id="progressBar"></div>

    <div class="header">
        <div class="category" id="catDisplay">Lade Daten...</div>
        <div class="question" id="qDisplay">...</div>
    </div>

    <div class="game-area">
        <div class="solution-area" id="solutionArea">
            <span style="color: #AAA; font-size: 14px; width: 100%; text-align: center; margin-top: 30px;" id="placeholderText">Tippe die Wörter in der richtigen Reihenfolge...</span>
        </div>

        <div class="pool-area" id="poolArea">
            </div>
    </div>

    <button class="next-btn" id="nextBtn" onclick="nextLevel()">Weiter</button>

    <script>
        // --- DEINE DATEN (Satzbau-Optimiert) ---
        // Lange Sätze wurden leicht gekürzt/angepasst für besseren Spielfluss, behalten aber den exakten juristischen Inhalt.
        const levels = [
            { cat: "Aufgabe 1", q: "Systematische Auslegung", a: "Feststellen des Aussagegehaltes anhand der Stellung im Gesetz" },
            { cat: "Aufgabe 1", q: "Historische Auslegung", a: "Ermittlung des Willens des historischen Gesetzgebers durch Materialien" },
            { cat: "Aufgabe 2", q: "Verfassungskonforme Auslegung", a: "Wahl der Deutung die mit dem Grundgesetz vereinbar ist" },
            { cat: "Aufgabe 3", q: "Staatszielbestimmung", a: "Verfassungsnorm die dem Staat Aufgaben vorgibt ohne subjektive Rechte" },
            { cat: "Aufgabe 4", q: "Anstalt (Öffentliches Recht)", a: "Zusammenfassung von Mitteln zur öffentlichen Aufgabe für Benutzer" },
            { cat: "Aufgabe 4", q: "Unterschied Körperschaft vs Anstalt", a: "Die Körperschaft hat Mitglieder die Anstalt hat Benutzer" },
            { cat: "Aufgabe 6", q: "Subordinationstheorie", a: "Liegt ein Über- und Unterordnungsverhältnis vor" },
            { cat: "Aufgabe 6", q: "Interessentheorie", a: "Dient die Norm dem öffentlichen Interesse oder Individualinteresse" },
            { cat: "Aufgabe 7", q: "Voraussetzung Klagebefugnis (§ 42 II VwGO)", a: "Möglichkeit einer Verletzung in eigenen subjektiven Rechten" },
            { cat: "Aufgabe 10", q: "Grundrechte für Staat (Grundsatz)", a: "Staat kann sich grundsätzlich nicht auf Grundrechte berufen" },
            { cat: "Aufgabe 10", q: "Rundfunkfreiheit Ausnahme", a: "Öffentlich-rechtliche Rundfunkanstalten können sich auf Rundfunkfreiheit berufen" },
            { cat: "Aufgabe 10", q: "Gebot der Vielfaltsicherung", a: "Gremium muss ein Spiegelbild der gesellschaftlichen Gruppen sein" },
            { cat: "Aufgabe 15", q: "Verwaltungsakt (§ 35 VwVfG)", a: "Hoheitliche Maßnahme einer Behörde zur Regelung eines Einzelfalls" },
            { cat: "Aufgabe 16", q: "Ermessensnichtgebrauch", a: "Behörde macht von eingeräumtem Ermessen keinen Gebrauch" },
            { cat: "Aufgabe 16", q: "Ermessensüberschreitung", a: "Behörde wählt eine Rechtsfolge die nicht im Gesetz steht" },
            { cat: "Aufgabe 20", q: "Unzuverlässigkeit (Gewerbe)", a: "Keine Gewähr für künftigen ordnungsgemäßen Betrieb des Gewerbes" }
        ];

        // --- GAME LOGIC ---
        let currentLevelIdx = 0;
        let currentWords = [];
        let targetWords = [];
        let formedWords = [];

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function initGame() {
            // Mischen der Level, damit es spannend bleibt
            shuffle(levels);
            loadLevel();
        }

        function loadLevel() {
            const level = levels[currentLevelIdx];
            
            // UI Reset
            document.getElementById('catDisplay').innerText = level.cat;
            document.getElementById('qDisplay').innerText = level.q;
            document.getElementById('solutionArea').innerHTML = '<span style="color: #AAA; font-size: 14px; width: 100%; text-align: center; margin-top: 35px;" id="placeholderText">Tippe die Wörter in der richtigen Reihenfolge...</span>';
            document.getElementById('solutionArea').classList.remove('complete');
            document.getElementById('nextBtn').classList.remove('show');
            document.getElementById('poolArea').innerHTML = '';
            
            // Progress
            const pct = (currentLevelIdx / levels.length) * 100;
            document.getElementById('progressBar').style.width = pct + "%";

            // Word Logic
            // Satz bereinigen und splitten
            targetWords = level.a.split(' ');
            formedWords = [];
            
            // Pool erstellen (kopieren und mischen)
            let poolWords = [...targetWords];
            shuffle(poolWords);

            // Bubbles rendern
            poolWords.forEach((word, index) => {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                bubble.innerText = word;
                bubble.dataset.word = word;
                // Unique ID falls ein Wort doppelt vorkommt
                bubble.id = 'b-' + index; 
                bubble.onclick = () => handleWordClick(bubble);
                document.getElementById('poolArea').appendChild(bubble);
            });
        }

        function handleWordClick(bubbleElement) {
            // Welches Wort wird als nächstes erwartet?
            const neededWord = targetWords[formedWords.length];
            const clickedWord = bubbleElement.innerText;

            if (clickedWord === neededWord) {
                // RICHTIG
                // 1. Placeholder weg
                const ph = document.getElementById('placeholderText');
                if(ph) ph.remove();

                // 2. Bubble visuell verschieben
                // Wir klonen die Bubble für die Solution Area, damit wir das Layout nicht zerschießen
                const solvedBubble = document.createElement('div');
                solvedBubble.className = 'bubble pop-in';
                solvedBubble.style.background = '#FFFFFF';
                solvedBubble.style.color = '#000';
                solvedBubble.style.cursor = 'default';
                solvedBubble.innerText = clickedWord;
                
                document.getElementById('solutionArea').appendChild(solvedBubble);

                // 3. Original Bubble verstecken
                bubbleElement.style.opacity = '0';
                bubbleElement.style.pointerEvents = 'none';

                // 4. Logik updaten
                formedWords.push(clickedWord);

                // 5. Check if finished
                if (formedWords.length === targetWords.length) {
                    levelComplete();
                }

            } else {
                // FALSCH
                bubbleElement.classList.add('shake');
                // Vibration (Haptik) auf Handy
                if(navigator.vibrate) navigator.vibrate(50);
                
                setTimeout(() => {
                    bubbleElement.classList.remove('shake');
                }, 400);
            }
        }

        function levelComplete() {
            document.getElementById('solutionArea').classList.add('complete');
            document.getElementById('nextBtn').classList.add('show');
            // Konfetti könnte hier hin ;)
        }

        function nextLevel() {
            currentLevelIdx++;
            if (currentLevelIdx < levels.length) {
                loadLevel();
            } else {
                // Game Over Screen (Quick & Dirty implementation inside the Q Display)
                document.getElementById('game-area').style.display = 'none';
                document.getElementById('header').innerHTML = "<h1>Geschafft!</h1><p>Du hast alle Definitionen gebaut.</p><button class='next-btn show' style='position:relative; transform:none;' onclick='location.reload()'>Nochmal</button>";
                document.getElementById('nextBtn').style.display = 'none';
            }
        }

        // Start
        initGame();

    </script>
</body>
</html>
