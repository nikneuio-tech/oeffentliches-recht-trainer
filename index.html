<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JUNIOR ASSOCIATE | Public Law</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Playfair+Display:ital,wght@0,600;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #121212;
            --panel-bg: #1e1e1e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent-green: #00e676;
            --accent-red: #ff5252;
            --accent-blue: #2979ff;
            --accent-gold: #ffd700;
            --border-color: #333;
            --font-serif: 'Playfair Display', serif;
            --font-mono: 'Fira Code', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: var(--font-mono);
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        #app-container {
            width: 100%;
            max-width: 900px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border-color);
            border-right: 1px solid var(--border-color);
            background-color: var(--panel-bg);
            position: relative;
        }

        /* --- HEADER --- */
        header {
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
            background: #181818;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 60px;
            flex-shrink: 0;
            z-index: 10;
            position: relative;
        }

        .case-id { font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; }
        
        .game-header-elements { display: none; align-items: center; gap: 15px; width: 100%; justify-content: space-between; }
        .trust-container { width: 150px; text-align: right; }
        .trust-label { font-size: 0.6rem; display: block; margin-bottom: 3px; color: var(--text-secondary); }
        .progress-bg { width: 100%; height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; width: 50%; background: var(--accent-blue); transition: width 0.5s ease, background 0.5s ease; }
        
        .btn-exit {
            background: transparent; border: none; color: var(--text-secondary); font-size: 1.2rem; cursor: pointer; padding: 5px;
        }
        .btn-exit:hover { color: var(--accent-red); }

        /* Timer Bar */
        #timer-container {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: transparent; z-index: 15;
            display: none; 
        }
        #timer-bar { height: 100%; background: var(--accent-green); width: 100%; transition: width 1s linear, background-color 0.5s; }

        /* --- MENU SCREEN --- */
        #menu-screen {
            flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px;
        }

        .menu-header { text-align: center; margin-bottom: 10px; padding-top: 10px; }
        .menu-title { font-family: var(--font-serif); font-size: 1.8rem; color: #fff; margin-bottom: 5px; }
        .menu-subtitle { font-size: 0.8rem; color: var(--text-secondary); }

        .archive-link { text-align: center; margin-bottom: 10px; }
        .btn-archive {
            background: transparent; border: 1px solid var(--text-secondary); color: var(--text-secondary);
            padding: 8px 20px; font-family: var(--font-mono); font-size: 0.8rem; cursor: pointer; text-transform: uppercase;
            border-radius: 4px; transition: all 0.2s;
        }
        .btn-archive:hover { border-color: var(--accent-blue); color: #fff; }

        .case-card {
            background: #252525; border: 1px solid var(--border-color); border-radius: 8px; padding: 15px;
            display: flex; flex-direction: column; gap: 10px; transition: transform 0.2s; cursor: pointer;
        }
        .case-card:hover { border-color: var(--text-secondary); background: #2a2a2a; }
        .case-card.completed { border-color: var(--accent-green); }
        .case-card.complex { border-left: 3px solid var(--accent-gold); }

        .card-top { display: flex; justify-content: space-between; align-items: flex-start; }
        .case-title { font-size: 1.1rem; font-weight: 600; color: #fff; margin-bottom: 4px; }
        .case-subtitle { font-size: 0.75rem; color: var(--accent-blue); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }

        .topics-preview { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 5px; }
        .topic-pill { font-size: 0.7rem; background: #333; color: #ccc; padding: 3px 8px; border-radius: 4px; border: 1px solid #444; }

        .case-mastery { margin-top: 10px; }
        .mastery-label { font-size: 0.7rem; color: var(--text-secondary); display: flex; justify-content: space-between; margin-bottom: 3px; }
        .mastery-bg { width: 100%; height: 4px; background: #111; border-radius: 2px; overflow: hidden; }
        .mastery-fill { height: 100%; width: 0%; background: var(--accent-blue); }
        
        .btn-start-case {
            background: transparent; border: 1px solid var(--accent-blue); color: var(--accent-blue);
            padding: 6px 12px; font-family: var(--font-mono); cursor: pointer; font-size: 0.75rem; text-transform: uppercase; border-radius: 4px;
            margin-left: 10px;
        }
        .btn-start-case:hover { background: var(--accent-blue); color: #fff; }

        /* --- DIFFICULTY SELECTOR --- */
        #difficulty-screen {
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(18, 18, 18, 0.98); flex-direction: column; align-items: center; justify-content: center; z-index: 50; padding: 20px;
        }
        .diff-card {
            background: #252525; border: 1px solid var(--border-color); width: 100%; max-width: 400px; padding: 20px; margin-bottom: 15px;
            border-radius: 8px; cursor: pointer; transition: 0.2s; text-align: left;
        }
        .diff-card:hover { transform: scale(1.02); }
        .diff-card.easy:hover { border-color: var(--accent-green); box-shadow: 0 0 15px rgba(0, 230, 118, 0.2); }
        .diff-card.medium:hover { border-color: var(--accent-blue); box-shadow: 0 0 15px rgba(41, 121, 255, 0.2); }
        .diff-card.hard:hover { border-color: var(--accent-red); box-shadow: 0 0 15px rgba(255, 82, 82, 0.2); }
        
        .diff-title { font-family: var(--font-serif); font-size: 1.2rem; color: #fff; margin-bottom: 5px; }
        .diff-desc { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 10px; }
        .diff-meta { font-size: 0.7rem; color: #666; text-transform: uppercase; letter-spacing: 1px; }

        /* --- ARCHIVE SCREEN --- */
        #archive-screen {
            display: none; flex: 1; padding: 20px; overflow-y: auto; flex-direction: column; background: var(--bg-color);
        }
        .archive-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;}
        .archive-list { display: flex; flex-direction: column; gap: 30px; }
        .archive-group h3 { color: var(--accent-blue); border-bottom: 1px solid #333; padding-bottom: 5px; margin-bottom: 15px; font-family: var(--font-serif); }
        .archive-item { background: #1a1a1a; padding: 20px; border-radius: 6px; border-left: 3px solid var(--text-secondary); margin-bottom: 15px; }
        .archive-q { font-weight: bold; margin-bottom: 10px; color: #fff; font-family: var(--font-serif); font-size: 1.1rem; }
        .archive-sol { font-size: 0.95rem; color: var(--text-primary); white-space: pre-wrap; line-height: 1.6; }

        /* --- GAME SCREEN --- */
        #game-screen { display: none; flex: 1; flex-direction: column; overflow: hidden; }

        #chat-window {
            flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth;
        }

        .message {
            max-width: 85%; padding: 15px 20px; border-radius: 4px; animation: fadeIn 0.3s ease-up; line-height: 1.5; position: relative;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .message.partner {
            align-self: flex-start; background-color: #252525; border-left: 3px solid var(--text-secondary);
            font-family: var(--font-serif); font-size: 1.1rem; color: #fff;
        }
        .message.partner::before { content: "SENIOR PARTNER"; position: absolute; top: -18px; left: 0; font-family: var(--font-mono); font-size: 0.6rem; color: var(--text-secondary); }

        .message.user { align-self: flex-end; background-color: #2a3b4d; border-right: 3px solid var(--accent-blue); text-align: right; font-size: 0.95rem; }

        .message.system { align-self: center; font-size: 0.8rem; padding: 8px 15px; border-radius: 20px; text-transform: uppercase; letter-spacing: 1px; text-align: center; }
        .message.system.success { color: var(--accent-green); border: 1px solid var(--accent-green); background: rgba(0, 230, 118, 0.05); }
        .message.system.fail { color: var(--accent-red); border: 1px solid var(--accent-red); background: rgba(255, 82, 82, 0.05); }
        .message.system.info { color: var(--accent-gold); border: 1px solid var(--accent-gold); background: rgba(255, 215, 0, 0.05); }

        /* --- INPUT AREA --- */
        #input-area {
            padding: 20px; border-top: 1px solid var(--border-color); background: #181818; min-height: 120px; display: flex; flex-direction: column; justify-content: center; gap: 10px;
        }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-option { background: transparent; border: 1px solid var(--text-secondary); color: var(--text-primary); padding: 12px; font-family: var(--font-mono); cursor: pointer; transition: all 0.2s; text-align: left; }
        .btn-option:hover { border-color: var(--accent-blue); background: rgba(41, 121, 255, 0.1); }
        .btn-option.wrong { border-color: var(--accent-red); color: var(--accent-red); opacity: 0.5; text-decoration: line-through; pointer-events: none; }
        
        .text-input-wrapper { display: flex; gap: 10px; flex-direction: column; }
        textarea { 
            flex: 1; background: transparent; border: 1px solid var(--text-secondary); color: #fff; padding: 12px; font-family: var(--font-mono); outline: none; resize: none; min-height: 80px; 
        }
        textarea:focus { border-color: var(--accent-blue); }
        .btn-submit { background: var(--accent-blue); color: #fff; border: none; padding: 12px; cursor: pointer; font-family: var(--font-mono); font-weight: 600; text-transform: uppercase; }
        
        .btn-giveup {
            width: 100%; padding: 10px; background: transparent; border: 1px dashed var(--text-secondary); color: var(--text-secondary);
            font-family: var(--font-mono); cursor: pointer; font-size: 0.8rem; text-transform: uppercase;
        }
        .btn-giveup:hover { border-color: var(--accent-red); color: var(--accent-red); }

        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }

        /* --- OVERLAYS --- */
        #game-over-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(18, 18, 18, 0.98);
            display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100;
        }
        .status-text { font-family: var(--font-serif); font-size: 2.5rem; margin-bottom: 10px; text-transform: uppercase; text-align: center; }
        .status-sub { font-size: 1rem; color: #888; margin-bottom: 30px; text-align: center; padding: 0 20px;}
        .btn-back { background: transparent; border: 1px solid #fff; color: #fff; padding: 12px 30px; cursor: pointer; font-family: var(--font-mono); margin-top: 10px; text-transform: uppercase; }
        .btn-back:hover { background: #fff; color: #000; }

        .reset-trigger { position: fixed; bottom: 5px; left: 5px; opacity: 0.2; font-size: 1.5rem; cursor: pointer; z-index: 200; }
    </style>
</head>
<body>

    <div id="app-container">
        <header>
            <div class="case-id" id="header-title">KANZLEI-SYSTEM v11.0</div>
            
            <div class="game-header-elements" id="game-header-elements">
                <div class="trust-container">
                    <span class="trust-label">PARTNER'S TRUST</span>
                    <div class="progress-bg">
                        <div class="progress-fill" id="trust-bar"></div>
                    </div>
                </div>
                <button class="btn-exit" onclick="exitToMenu()">‚úï</button>
            </div>
            
            <div id="timer-container"><div id="timer-bar"></div></div>
        </header>

        <div id="menu-screen">
            <div class="menu-header">
                <div class="menu-title">Aktenbestand</div>
                <div class="menu-subtitle">√ñffentliches Recht - Training Mode</div>
            </div>
            
            <div class="archive-link">
                <button class="btn-archive" onclick="showArchive()">üìÇ Aktenarchiv (Volltext)</button>
            </div>

            <div id="case-list"></div>
        </div>

        <div id="difficulty-screen">
            <div class="menu-title" style="margin-bottom: 30px;">W√§hlen Sie Ihre Position</div>
            
            <div class="diff-card easy" onclick="selectDifficulty('easy')">
                <div class="diff-title">Junior Associate</div>
                <div class="diff-desc">Gef√ºhrtes Vorgehen. Der Partner stellt kleinteilige Fragen. Hinweise verf√ºgbar.</div>
                <div class="diff-meta">Zeit: 90s | Risiko: Gering</div>
            </div>

            <div class="diff-card medium" onclick="selectDifficulty('medium')">
                <div class="diff-title">Associate</div>
                <div class="diff-desc">Checkliste wird gestellt. Sie m√ºssen die Begriffe selbst einordnen.</div>
                <div class="diff-meta">Zeit: 60s | Risiko: Mittel</div>
            </div>

            <div class="diff-card hard" onclick="selectDifficulty('hard')">
                <div class="diff-title">Partner</div>
                <div class="diff-desc">High Stakes. Freies Gutachten ohne Hilfestellung. Jedes Wort z√§hlt.</div>
                <div class="diff-meta">Zeit: 45s | Risiko: Hoch</div>
            </div>
            <button class="btn-back" style="margin-top:20px; font-size: 0.8rem;" onclick="exitToMenu()">Abbrechen</button>
        </div>

        <div id="archive-screen">
            <div class="archive-header">
                <div class="menu-title" style="font-size: 1.2rem;">Musterl√∂sungen</div>
                <button class="btn-back" style="margin:0; padding: 5px 15px; font-size: 0.8rem;" onclick="exitToMenu()">Zur√ºck</button>
            </div>
            <div id="archive-content" class="archive-list"></div>
        </div>

        <div id="game-screen">
            <div id="chat-window"></div>
            <div id="input-area"></div>
        </div>

        <div id="game-over-screen">
            <div class="status-text" id="overlay-title">STATUS</div>
            <div class="status-sub" id="overlay-msg"></div>
            <button class="btn-back" onclick="exitToMenu()">Zur√ºck zur √úbersicht</button>
        </div>
        
        <div class="reset-trigger" onclick="hardReset()" title="Spielstand l√∂schen (Reset)">üóëÔ∏è</div>
    </div>

    <script>
        // --- EDIT HERE: CASES & QUESTIONS ---
        const cases = [
            // STANDARD TASKS
            {
                id: "AKTE_001", complexity: 'standard',
                title: "Grundlagen & Methoden", subtitle: "Aufgaben 1, 2, 5",
                topics: ["Systematische Auslegung", "Historische Auslegung", "Verfassungskonforme Auslegung", "Richtlinienkonforme Auslegung"],
                questions: [
                    { type: 'choice', intro: "Ein Gesetz ist unklar. Wir ermitteln den Inhalt anhand der Stellung im Gesetz. Welche Auslegung?", options: ["Historische Auslegung", "Systematische Auslegung", "Teleologische Auslegung"], correctAnswer: 1, feedback: "Korrekt.", explanation: "Systematische Auslegung pr√ºft die Stellung im Gesetz." },
                    { type: 'text', intro: "Was versteht man unter 'Historischer Auslegung'?", keywords: ["wille", "gesetzgeber", "geschichte", "materialien"], explanation: "Ermittlung des Willens des historischen Gesetzgebers.", feedback: "Richtig." },
                    { type: 'choice', intro: "Ein Gesetz verst√∂√üt scheinbar gegen das GG. Was besagt die 'verfassungskonforme Auslegung'?", options: ["Gesetz ist nichtig.", "Diejenige Deutung w√§hlen, die mit dem GG vereinbar ist.", "BVerfG fragen."], correctAnswer: 1, feedback: "Exakt.", explanation: "Die Norm bleibt g√ºltig." },
                    { type: 'text', intro: "Wo werden vom Bundespr√§sidenten ausgefertigte Gesetze ver√∂ffentlicht?", keywords: ["bundesgesetzblatt", "bgbl"], explanation: "Im Bundesgesetzblatt.", feedback: "Korrekt." }
                ],
                detailed_solution: `Aufgabe 1: Systematische Auslegung ist das Feststellen des normativen Aussagegehaltes einer Norm anhand ihrer Stellung im Gesetz oder im Gesamtzusammenhang der Rechtsordnung.\nAufgabe 2: Verfassungskonforme Auslegung bedeutet, dass wenn ein Gesetz mehrere Deutungen zul√§sst, diejenige zu w√§hlen ist, die mit dem Grundgesetz vereinbar ist.`
            },
            {
                id: "AKTE_002", complexity: 'standard',
                title: "Staatsorganisation", subtitle: "Aufgaben 3, 4, 11",
                topics: ["Staatsziele", "Anstalt vs. K√∂rperschaft", "Stiftung", "Demokratieprinzip"],
                questions: [
                    { type: 'text', intro: "Was ist eine Staatszielbestimmung? (Def + Bsp)", keywords: ["aufgabe", "staat", "subjektiv", "recht"], explanation: "Verfassungsnorm, die dem Staat Aufgaben vorgibt.", feedback: "Gut." },
                    { type: 'text', intro: "Definieren Sie 'Anstalt des √∂ffentlichen Rechts'.", keywords: ["personal", "sachmittel", "benutzer"], explanation: "Zusammenfassung von Personal/Sachen zur Erf√ºllung einer √∂ff. Aufgabe f√ºr Benutzer.", feedback: "Richtig." },
                    { type: 'choice', intro: "Unterschied zur K√∂rperschaft?", options: ["K√∂rperschaft ist privat.", "K√∂rperschaft ist mitgliedschaftlich organisiert.", "Kein Unterschied."], correctAnswer: 1, feedback: "Richtig.", explanation: "K√∂rperschaft = Mitglieder. Anstalt = Benutzer." },
                    { type: 'text', intro: "Nennen Sie ein Beispiel im GG f√ºr das Demokratieprinzip.", keywords: ["20", "wahlen", "abstimmung"], explanation: "Art. 20 Abs. 1 und 2 GG.", feedback: "Kernvorschrift." }
                ],
                detailed_solution: `Aufgabe 3: Staatszielbestimmung ist eine Verfassungsnorm, die dem Staat Aufgaben vorgibt, ohne subjektive Rechte f√ºr den Einzelnen zu begr√ºnden (Bsp: Sozialstaat).\nAufgabe 4: Anstalt ist eine Zusammenfassung von Personal- und Sachmitteln zur Erf√ºllung einer √∂ffentlichen Aufgabe f√ºr Benutzer. Eine K√∂rperschaft ist mitgliedschaftlich organisiert.`
            },
            // COMPLEX: NOSSEN (Task 6 - FULL DETAIL)
            {
                id: "AKTE_003", complexity: 'high',
                title: "Fall: Nossen vs. Ketzerbachtal", subtitle: "Aufgabe 6 (Rechtsweg)",
                topics: ["Rechtsweger√∂ffnung", "Abgrenzungstheorien", "S√§chsKomZG"],
                questions_easy: [
                    { type: 'choice', intro: "Streit um Verwaltungsgemeinschaft. Welcher Rechtsweg ist er√∂ffnet?", options: ["Zivilrechtsweg", "Verwaltungsrechtsweg (¬ß 40 VwGO)", "Verfassungsrechtsweg"], correctAnswer: 1, feedback: "Richtig.", explanation: "√ñffentlich-rechtliche Streitigkeit." },
                    { type: 'choice', intro: "Welche Theorie fragt nach einem √úber-/Unterordnungsverh√§ltnis?", options: ["Interessentheorie", "Subordinationstheorie", "Sonderrechtstheorie"], correctAnswer: 1, feedback: "Korrekt.", explanation: "Subordinationstheorie." },
                    { type: 'choice', intro: "Welche Theorie fragt, ob ein Hoheitstr√§ger berechtigt ist?", options: ["Interessentheorie", "Subordinationstheorie", "Modifizierte Subjektstheorie"], correctAnswer: 2, feedback: "Richtig.", explanation: "Modifizierte Subjektstheorie." }
                ],
                questions_medium: [
                    { type: 'text', intro: "Pr√ºfen Sie die Rechtsweger√∂ffnung. Nennen Sie die drei Theorien.", keywords: ["subordination", "interesse", "subjekt", "sonderrecht"], explanation: "Subordinationstheorie, Interessentheorie, Modifizierte Subjektstheorie.", feedback: "Gut." },
                    { type: 'text', intro: "Subsumieren Sie: Warum ist es hier √∂ffentliches Recht?", keywords: ["zusammenarbeit", "kommunal", "hoheitstr√§ger", "zuordnung"], explanation: "Kommunale Zusammenarbeit = √ñff. Interesse. S√§chsKomZG = Sonderrecht.", feedback: "Korrekt." }
                ],
                questions_hard: [
                    { type: 'text', intro: "Gutachten: Pr√ºfen und erl√§utern Sie, ob der Rechtsweg zu den Verwaltungsgerichten er√∂ffnet ist. Gehen Sie auf die Abgrenzungstheorien ein.", keywords: ["40", "vwgo", "subordination", "interesse", "subjekt", "sonderrecht", "hoheitstr√§ger", "s√§chskomzg", "zusammenarbeit"], explanation: "¬ß 40 VwGO. Subordinationstheorie (√úber/Unterordnung), Interessentheorie (√ñff. Interesse), Mod. Subjektstheorie (Sonderrecht). Hier: S√§chsKomZG.", feedback: "Umfassend gepr√ºft." }
                ],
                detailed_solution: `Aufgabe 6 L√∂sung:
1. Obersatz: Der Rechtsweg zu den Verwaltungsgerichten ist gem. ¬ß 40 Abs. 1 VwGO er√∂ffnet, wenn es sich um eine √∂ffentlich-rechtliche Streitigkeit nichtverfassungsrechtlicher Art handelt und keine abdr√§ngende Sonderzuweisung vorliegt.

2. Abgrenzungstheorien (Privatrecht vs. √ñffentliches Recht):
a) Subordinationstheorie (Subjektionstheorie): Ein √∂ffentlich-rechtliches Verh√§ltnis liegt vor, wenn ein √úber-/Unterordnungsverh√§ltnis zwischen den Beteiligten besteht. (Hier eher Gleichordnung, daher unergiebig).
b) Interessentheorie: Dient die Norm √ºberwiegend dem √∂ffentlichen Interesse (Allgemeinwohl) oder dem Individualinteresse? (Hier: Kommunale Zusammenarbeit = √ñffentliches Interesse).
c) Modifizierte Subjektstheorie (Sonderrechtstheorie): Eine Norm ist √∂ffentlich-rechtlich, wenn sie einen Tr√§ger hoheitlicher Gewalt gerade in seiner Eigenschaft als solcher berechtigt oder verpflichtet (Sonderrecht des Staates).

3. Subsumtion:
Gegenstand des Streits ist die Verwaltungsgemeinschaft nach dem S√§chsKomZG. Das S√§chsKomZG berechtigt und verpflichtet ausschlie√ülich Gemeinden (Hoheitstr√§ger) zur Zusammenarbeit. Damit handelt es sich um Sonderrecht des Staates. Es liegt eine √∂ffentlich-rechtliche Streitigkeit vor. Der Verwaltungsrechtsweg (¬ß 40 VwGO) ist er√∂ffnet.`
            },
            // COMPLEX: WINDKRAFT (Task 7 - FULL DETAIL)
            {
                id: "AKTE_004", complexity: 'high',
                title: "Fall: Windkraft (F√∂rster)", subtitle: "Aufgabe 7 (Zul√§ssigkeit)",
                topics: ["Anfechtungsklage", "Klagebefugnis", "Art. 14 GG", "Gemeinde-Klagerecht"],
                questions_easy: [
                    { type: 'choice', intro: "Rechtsnatur der Genehmigung?", options: ["Realakt", "Verwaltungsakt (¬ß 35 VwVfG)", "Verordnung"], correctAnswer: 1, feedback: "Korrekt.", explanation: "Verwaltungsakt." },
                    { type: 'choice', intro: "Statthafte Klageart f√ºr Aufhebung?", options: ["Verpflichtungsklage", "Anfechtungsklage (¬ß 42 I VwGO)", "Feststellungsklage"], correctAnswer: 1, feedback: "Richtig.", explanation: "Anfechtungsklage." },
                    { type: 'text', intro: "Voraussetzung f√ºr Klagebefugnis (¬ß 42 II VwGO)?", keywords: ["m√∂glichkeit", "verletzung", "rechte", "subjektiv"], explanation: "M√∂glichkeit einer Verletzung in eigenen subjektiven Rechten.", feedback: "Exakt." }
                ],
                questions_medium: [
                    { type: 'text', intro: "Bestimmen Sie Klageart und Vorverfahren.", keywords: ["anfechtung", "widerspruch", "68"], explanation: "Anfechtungsklage (¬ß 42 VwGO). Vorgeschaltet: Widerspruch (¬ß 68 VwGO).", feedback: "Gut." },
                    { type: 'text', intro: "Begr√ºnden Sie die Klagebefugnis des Hoteliers.", keywords: ["eigentum", "14", "betrieb", "m√∂glichkeit"], explanation: "M√∂glichkeit der Verletzung von Art. 14 GG (Eigentum).", feedback: "Richtig." }
                ],
                questions_hard: [
                    { type: 'text', intro: "Gutachten: Pr√ºfen Sie die Zul√§ssigkeit der Klage (Statthafte Klageart, Befugnis). Wie w√§re es, wenn die Stadt L√∂bau klagt?", keywords: ["anfechtung", "verwaltungsakt", "35", "widerspruch", "68", "klagebefugnis", "42", "m√∂glichkeit", "eigentum", "14", "gemeinde", "28", "planungshoheit"], explanation: "VA -> Anfechtungsklage. Vorverfahren: Widerspruch. Befugnis: M√∂glichkeitstheorie (Art. 14 GG). Stadt L√∂bau: Art. 28 II GG (Planungshoheit).", feedback: "Exzellent." }
                ],
                detailed_solution: `Aufgabe 7 L√∂sung:
A. Zul√§ssigkeit der Klage des Hoteliers F√∂rster:
1. Statthafte Klageart: August F√∂rster begehrt die Aufhebung der Genehmigung. Da die Genehmigung ein Verwaltungsakt i.S.v. ¬ß 35 VwVfG ist (hoheitliche Ma√ünahme, Beh√∂rde, Regelung, Einzelfall, Au√üenwirkung), ist die Anfechtungsklage gem√§√ü ¬ß 42 Abs. 1 Alt. 1 VwGO statthaft.
2. Klagebefugnis (¬ß 42 Abs. 2 VwGO): Er muss geltend machen, durch den VA in seinen Rechten verletzt zu sein. Es reicht die M√∂glichkeit einer Rechtsverletzung (M√∂glichkeitstheorie). Hier kommt eine Verletzung seines Eigentums am eingerichteten und ausge√ºbten Gewerbebetrieb (Art. 14 GG) in Betracht.
3. Vorverfahren: Gem√§√ü ¬ß 68 VwGO ist grunds√§tzlich ein Widerspruchsverfahren (Vorverfahren) durchzuf√ºhren.

B. Klage der Stadt L√∂bau:
Wenn die Gemeinde klagt, kann sie sich nicht auf Grundrechte berufen (Konfusionsargument, da Teil des Staates). Sie muss sich stattdessen auf ihr Recht auf kommunale Selbstverwaltung (Planungshoheit) aus Art. 28 Abs. 2 GG berufen.`
            },
            // STANDARD TASKS
            {
                id: "AKTE_005", complexity: 'standard',
                title: "Normen & Verfassung", subtitle: "Aufgaben 8, 9, 10, 12",
                topics: ["Normarten (TKG)", "Art. 13 GG", "Grundrechte Staat", "Rundfunkfreiheit", "Gesetzgebungskompetenz"],
                questions: [
                    { type: 'choice', intro: "¬ß 87 I TKG gibt ein Ziel vor. Normart?", options: ["Konditional", "Final", "Deskriptiv"], correctAnswer: 1, feedback: "Final = Ziel.", explanation: "Final gefasste Norm." },
                    { type: 'choice', intro: "¬ß 110 I TKG (Wenn-Dann)?", options: ["Konditional", "Final", "Deskriptiv"], correctAnswer: 0, feedback: "Korrekt.", explanation: "Konditional gefasste Norm." },
                    { type: 'text', intro: "Art. 13 GG. Sind Gesch√§ftsr√§ume gesch√ºtzt?", keywords: ["ja", "√∂ffnungszeiten", "ladenschluss"], explanation: "Ja. Aber w√§hrend √ñffnungszeiten geringerer Schutz.", feedback: "Richtig." },
                    { type: 'text', intro: "ZDF-Fall. Kann sich der Staat auf Grundrechte berufen?", keywords: ["nein", "konfusion", "rundfunkfreiheit"], explanation: "Grundsatz: Nein. Ausnahme: Rundfunkfreiheit.", feedback: "Korrekt." },
                    { type: 'choice', intro: "Corona-Notbremse Kompetenz?", options: ["L√§nder", "Bund", "EU"], correctAnswer: 1, feedback: "Richtig.", explanation: "Bund. Art. 74 GG (Gemeingef√§hrliche Krankheiten)." }
                ],
                detailed_solution: `Aufgabe 8: a) ¬ß 87 TKG: Final. b) ¬ß 110 TKG: Konditional. c) ¬ß 3 TKG: Deskriptiv.\nAufgabe 9: Gesch√§ftsr√§ume fallen unter 'Wohnung' (Art. 13 GG). W√§hrend √ñffnungszeiten geringerer Schutz.\nAufgabe 10: Grundsatz: Staat kann sich nicht auf Grundrechte berufen (Konfusionsargument). Ausnahme: Rundfunkfreiheit. Gremien: Gebot der Vielfaltsicherung und Staatsferne (Drittel-Quote).`
            },
            {
                id: "AKTE_006", complexity: 'standard',
                title: "Verwaltung & Europa", subtitle: "Aufgaben 13-19",
                topics: ["EU-Grundfreiheiten", "Amtshaftung", "VA-Definition", "Ermessen", "Widerruf", "EU-Grundrechte"],
                questions: [
                    { type: 'text', intro: "Nennen Sie zwei EU-Grundfreiheiten.", keywords: ["waren", "arbeitnehmer", "dienstleistung", "kapital"], explanation: "Warenverkehr, Arbeitnehmerfreiz√ºgigkeit, Dienstleistung, Niederlassung.", feedback: "Gut." },
                    { type: 'choice', intro: "Amtshaftung Anspruchsgrundlage?", options: ["¬ß 823 BGB", "¬ß 839 BGB i.V.m. Art. 34 GG", "VwGO"], correctAnswer: 1, feedback: "Richtig.", explanation: "¬ß 839 BGB + Art. 34 GG." },
                    { type: 'text', intro: "Definition Verwaltungsakt (¬ß 35 VwVfG).", keywords: ["hoheitlich", "beh√∂rde", "regelung", "einzelfall", "au√üenwirkung"], explanation: "Hoheitliche Ma√ünahme einer Beh√∂rde auf Gebiet des √∂ff. Rechts zur Regelung eines Einzelfalls mit Au√üenwirkung.", feedback: "Wichtig!" },
                    { type: 'text', intro: "Nennen Sie einen Ermessensfehler.", keywords: ["nichtgebrauch", "√ºberschreitung", "fehlgebrauch"], explanation: "Ermessensnichtgebrauch, -√ºberschreitung, -fehlgebrauch.", feedback: "Richtig." },
                    { type: 'text', intro: "Norm f√ºr Widerruf?", keywords: ["49"], explanation: "¬ß 49 VwVfG.", feedback: "Korrekt." }
                ],
                detailed_solution: `Aufgabe 14: Amtshaftung: ¬ß 839 I BGB i.V.m. Art. 34 GG.\nAufgabe 15: VA = Hoheitliche Ma√ünahme einer Beh√∂rde auf dem Gebiet des √∂ff. Rechts zur Regelung eines Einzelfalls mit Au√üenwirkung (¬ß 35 VwVfG).\nAufgabe 17: Widerruf geregelt in ¬ß 49 VwVfG.`
            },
            // COMPLEX: BUS (Task 20)
            {
                id: "AKTE_007", complexity: 'high',
                title: "Fall: Busunternehmer", subtitle: "Aufgabe 20 (Gewerbe)",
                topics: ["Spezialgesetz PBefG", "Unzuverl√§ssigkeit", "Widerruf"],
                questions_easy: [
                    { type: 'choice', intro: "Busunternehmer zahlt Steuern nicht. Lizenzentzug. Rechtsgrundlage?", options: ["¬ß 35 GewO", "¬ß 25 PBefG", "¬ß 48 VwVfG"], correctAnswer: 1, feedback: "Wichtig! Spezialgesetz.", explanation: "PBefG vor GewO." },
                    { type: 'text', intro: "Ma√ünahme?", keywords: ["widerruf", "genehmigung"], explanation: "Widerruf der Genehmigung.", feedback: "Ja." },
                    { type: 'text', intro: "Begriff der 'Unzuverl√§ssigkeit'?", keywords: ["gew√§hr", "k√ºnftig", "ordnungsgem√§√ü"], explanation: "Keine Gew√§hr f√ºr k√ºnftigen ordnungsgem√§√üen Betrieb.", feedback: "Genau." }
                ],
                questions_medium: [
                    { type: 'text', intro: "Bestimmen Sie Erm√§chtigungsgrundlage und Ma√ünahme.", keywords: ["25", "pbefg", "widerruf"], explanation: "Widerruf nach ¬ß 25 Abs. 1 PBefG.", feedback: "Gut." },
                    { type: 'text', intro: "Nennen Sie die Tatbestandsvoraussetzungen.", keywords: ["wegfall", "tatsachen", "unzuverl√§ssigkeit"], explanation: "Wegfall Voraussetzungen, Konkrete Tatsachen, Unzuverl√§ssigkeit.", feedback: "Richtig." }
                ],
                questions_hard: [
                    { type: 'text', intro: "Gutachten: Nach welcher Erm√§chtigungsgrundlage kann vorgegangen werden? Nennen Sie alle Tatbestandsvoraussetzungen und definieren Sie die Unzuverl√§ssigkeit.", keywords: ["25", "pbefg", "widerruf", "spezialgesetz", "wegfall", "voraussetzungen", "tatsachen", "unzuverl√§ssigkeit", "prognose", "gew√§hr", "k√ºnftig", "ordnungsgem√§√ü"], explanation: "EGL: ¬ß 25 I PBefG (Spezialgesetz). Ma√ünahme: Widerruf. Voraussetzungen: 1. Wegfall Genehmigungsvoraussetzungen, 2. Konkrete Tatsachen, 3. Unzuverl√§ssigkeit (Negative Zukunftsprognose).", feedback: "Perfekt." }
                ],
                detailed_solution: `Aufgabe 20 L√∂sung:\n1. Rechtsgrundlage: Spezialgesetz Personenbef√∂rderungsgesetz (PBefG), nicht GewO! Ma√ünahme: Widerruf der Genehmigung gem√§√ü ¬ß 25 Abs. 1 PBefG.\n2. Tatbestandsvoraussetzungen:\n- Wegfall der Genehmigungsvoraussetzungen.\n- Konkrete Tatsachen (z.B. Steuerschulden).\n- Unzuverl√§ssigkeit: Gewerbetreibender bietet nach Gesamteindruck nicht die Gew√§hr f√ºr k√ºnftigen ordnungsgem√§√üen Betrieb (Negative Zukunftsprognose).`
            }
        ];

        // --- ENGINE LOGIC ---
        let activeCase = null;
        let qIndex = 0;
        let trust = 50;
        let savedProgress = {};
        let currentQuestions = [];
        let timerInterval = null;
        let timeLimit = 60;
        let timeLeft = 60;

        try {
            const data = localStorage.getItem('junior_lawyer_save_v11');
            if (data) savedProgress = JSON.parse(data);
        } catch (e) {
            console.log("Resetting save.");
            savedProgress = {};
        }

        const menuScreen = document.getElementById('menu-screen');
        const diffScreen = document.getElementById('difficulty-screen');
        const gameScreen = document.getElementById('game-screen');
        const archiveScreen = document.getElementById('archive-screen');
        const caseList = document.getElementById('case-list');
        const archiveContent = document.getElementById('archive-content');
        const gameHeader = document.getElementById('game-header-elements');
        const chatWindow = document.getElementById('chat-window');
        const inputArea = document.getElementById('input-area');
        const overlay = document.getElementById('game-over-screen');
        const timerContainer = document.getElementById('timer-container');
        const timerBar = document.getElementById('timer-bar');

        window.onerror = function(msg, url, line) {
            alert("Fehler: " + msg);
        };

        function init() { renderMenu(); }

        function renderMenu() {
            caseList.innerHTML = '';
            cases.forEach((c, idx) => {
                let highScore = savedProgress[c.id] || 0;
                let barW = highScore + "%";
                let barC = highScore > 70 ? 'var(--accent-green)' : (highScore > 0 ? 'var(--accent-blue)' : '#333');
                let topics = c.topics.map(t => `<span class="topic-pill">${t}</span>`).join('');
                let isComplex = c.complexity === 'high';

                const card = document.createElement('div');
                card.className = `case-card ${isComplex ? 'complex' : ''}`;
                if(highScore >= 100) card.classList.add('completed');
                card.onclick = (e) => { if(!e.target.classList.contains('btn-start-case')) prepareCase(idx); };
                
                card.innerHTML = `
                    <div class="card-top">
                        <div style="flex:1">
                            <div class="case-title">${c.title}</div>
                            <div class="case-subtitle">${c.subtitle} ${isComplex ? '‚òÖ' : ''}</div>
                        </div>
                        <button class="btn-start-case" onclick="event.stopPropagation(); prepareCase(${idx})">Start</button>
                    </div>
                    <div class="topics-preview">${topics}</div>
                    <div class="case-mastery">
                        <div class="mastery-label"><span>Wissen:</span><span>${highScore}%</span></div>
                        <div class="mastery-bg"><div class="mastery-fill" style="width:${barW}; background:${barC}"></div></div>
                    </div>
                `;
                caseList.appendChild(card);
            });
        }

        let selectedCaseIdx = -1;

        function prepareCase(idx) {
            selectedCaseIdx = idx;
            const c = cases[idx];
            if (c.complexity === 'high') {
                menuScreen.style.display = 'none';
                diffScreen.style.display = 'flex';
            } else {
                startStandard(idx);
            }
        }

        function selectDifficulty(diff) {
            diffScreen.style.display = 'none';
            const c = cases[selectedCaseIdx];
            if (diff === 'easy') { currentQuestions = c.questions_easy; timeLimit = 90; } 
            else if (diff === 'medium') { currentQuestions = c.questions_medium; timeLimit = 60; } 
            else { currentQuestions = c.questions_hard; timeLimit = 45; }
            launchGame(c);
        }

        function startStandard(idx) {
            const c = cases[idx];
            currentQuestions = c.questions;
            timeLimit = 60;
            menuScreen.style.display = 'none';
            launchGame(c);
        }

        function launchGame(c) {
            activeCase = c;
            qIndex = 0;
            trust = 50;
            gameScreen.style.display = 'flex';
            gameHeader.style.display = 'flex';
            timerContainer.style.display = 'block';
            updateTrust();
            chatWindow.innerHTML = '';
            addMsg('system', 'AKTE GELADEN: ' + activeCase.title, 'info');
            setTimeout(nextQ, 800);
        }

        function startTimer() {
            timeLeft = timeLimit;
            timerBar.style.width = '100%';
            timerBar.style.backgroundColor = 'var(--accent-green)';
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                let pct = (timeLeft / timeLimit) * 100;
                timerBar.style.width = pct + '%';
                if (timeLeft < 10) timerBar.style.backgroundColor = 'var(--accent-red)';
                if (timeLeft <= 0) { clearInterval(timerInterval); handleTimeout(); }
            }, 1000);
        }

        function stopTimer() { clearInterval(timerInterval); }

        function handleTimeout() {
            inputArea.innerHTML = '';
            trust = Math.max(0, trust - 10);
            addMsg('system', 'ZEIT ABGELAUFEN', 'fail');
            addMsg('partner', "Zu langsam! Mandant ver√§rgert.");
            updateTrust();
            if(trust === 0) endCase(false);
            else {
                const btn = document.createElement('button');
                btn.className = 'btn-giveup';
                btn.innerText = 'Weiter';
                btn.onclick = () => { qIndex++; nextQ(); };
                inputArea.appendChild(btn);
            }
        }

        function nextQ() {
            if (qIndex >= currentQuestions.length) return endCase(true);
            const q = currentQuestions[qIndex];
            addMsg('partner', q.intro);
            renderInp(q);
            startTimer();
        }

        function renderInp(q) {
            inputArea.innerHTML = '';
            const btnReveal = document.createElement('button');
            btnReveal.className = 'btn-giveup';
            btnReveal.innerText = 'L√∂sung aufdecken (Joker) -15%';
            btnReveal.onclick = () => revealSolution(q);

            if (q.type === 'choice') {
                const grid = document.createElement('div');
                grid.className = 'options-grid';
                q.options.forEach((opt, i) => {
                    const btn = document.createElement('button');
                    btn.className = 'btn-option';
                    btn.innerText = "> " + opt;
                    btn.onclick = (e) => checkChoice(i, q, e.target);
                    grid.appendChild(btn);
                });
                inputArea.appendChild(grid);
            } else {
                const wrp = document.createElement('div');
                wrp.className = 'text-input-wrapper';
                const inp = document.createElement('textarea');
                inp.placeholder = 'Ihre Antwort...';
                const btn = document.createElement('button');
                btn.className = 'btn-submit';
                btn.innerText = 'SENDEN';
                btn.onclick = () => checkText(inp.value, q);
                wrp.append(inp, btn);
                inputArea.appendChild(wrp);
                setTimeout(() => inp.focus(), 100);
            }
            inputArea.appendChild(btnReveal);
        }

        function checkChoice(val, q, btn) {
            if (val === q.correctAnswer) {
                stopTimer();
                inputArea.innerHTML = '';
                addMsg('user', q.options[val]);
                processSuccess(q);
            } else {
                btn.classList.add('wrong');
                trust = Math.max(0, trust - 5);
                addMsg('system', 'Falsch. Versuch es erneut.', 'fail');
                updateTrust();
                if(trust === 0) { stopTimer(); endCase(false); }
            }
        }

        function checkText(val, q) {
            const lowerVal = val.toLowerCase();
            // Fuzzy Check: Contains ANY key keyword for simple, MOST for hard
            const foundCount = q.keywords.filter(k => lowerVal.includes(k.toLowerCase())).length;
            
            // Logic: Needs at least 1 keyword match
            if (foundCount > 0) {
                stopTimer();
                inputArea.innerHTML = '';
                addMsg('user', val);
                processSuccess(q);
            } else {
                trust = Math.max(0, trust - 5);
                addMsg('system', 'Zu ungenau oder falsch. Pr√ºfen Sie die Definition.', 'fail');
                updateTrust();
                if(trust === 0) { stopTimer(); endCase(false); }
            }
        }

        function revealSolution(q) {
            stopTimer();
            inputArea.innerHTML = '';
            addMsg('user', '(Joker)');
            trust = Math.max(0, trust - 15);
            addMsg('partner', 'L√∂sung: ' + q.explanation);
            addMsg('system', 'STRAFE -15%', 'fail');
            updateTrust();
            if(trust === 0) endCase(false);
            else { qIndex++; setTimeout(nextQ, 3000); }
        }

        function processSuccess(q) {
            trust = Math.min(100, trust + 10);
            addMsg('partner', q.feedback);
            addMsg('system', 'VERTRAUEN GESTIEGEN', 'success');
            updateTrust();
            qIndex++;
            setTimeout(nextQ, 1500);
        }

        function endCase(win) {
            stopTimer();
            overlay.style.display = 'flex';
            const t = document.getElementById('overlay-title');
            const m = document.getElementById('overlay-msg');
            if (win) {
                t.innerText = "FALL ABGESCHLOSSEN";
                t.style.color = "var(--accent-green)";
                m.innerText = "Score: " + trust + "%";
                let old = savedProgress[activeCase.id] || 0;
                if (trust > old) {
                    savedProgress[activeCase.id] = trust;
                    localStorage.setItem('junior_lawyer_save_v11', JSON.stringify(savedProgress));
                }
            } else {
                t.innerText = "GESCHEITERT";
                t.style.color = "var(--accent-red)";
                m.innerText = "Vertrauen auf 0.";
            }
        }

        function showArchive() {
            menuScreen.style.display = 'none';
            archiveScreen.style.display = 'flex';
            archiveContent.innerHTML = '';
            cases.forEach(c => {
                const grp = document.createElement('div');
                grp.className = 'archive-group';
                grp.innerHTML = `<h3>${c.title}</h3>`;
                const sol = document.createElement('div');
                sol.className = 'archive-item';
                sol.innerHTML = `<div class="archive-q">Musterl√∂sung</div><div class="archive-sol">${c.detailed_solution}</div>`;
                grp.appendChild(sol);
                archiveContent.appendChild(grp);
            });
        }

        function addMsg(cls, txt, type) {
            const d = document.createElement('div');
            d.className = `message ${cls} ${type||''}`;
            d.innerText = txt;
            chatWindow.appendChild(d);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function updateTrust() {
            const b = document.getElementById('trust-bar');
            b.style.width = trust + "%";
            b.style.background = trust > 70 ? 'var(--accent-green)' : (trust < 30 ? 'var(--accent-red)' : 'var(--accent-blue)');
        }

        function exitToMenu() {
            stopTimer();
            menuScreen.style.display = 'flex';
            gameScreen.style.display = 'none';
            archiveScreen.style.display = 'none';
            gameHeader.style.display = 'none';
            timerContainer.style.display = 'none';
            diffScreen.style.display = 'none';
            overlay.style.display = 'none';
            renderMenu();
        }

        function hardReset() {
            if(confirm("Spielstand l√∂schen?")) {
                localStorage.removeItem('junior_lawyer_save_v11');
                location.reload();
            }
        }

        window.onload = init;
    </script>
</body>
</html>
